<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Leitor Temperatura</title>
  <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>
  <style>
    .block{
      /* background-color: #ccc; */
      margin: 0 auto;
    }
  </style>
  <div class="container" id="app">
    <div class="row align-items-center" :style="{ height: heightWindow + 'px' }">
      <div class="col-4 offset-md-2">
        <div class="card">
          <h5 class="card-header">Leitor de Temperatura</h5>
          <div class="card-body">
            <h2 class="card-title text-center">
              {{temp}}°C
            </h2>
            <p class="card-text text-center">
              <span v-if="tag" :class="['badge', 'badge-' + tag.class]">{{ tag.label }}</span>
            </p>
          </div>
        </div>
      </div>
      <div class="col-4">
        <div class="card">
          <h5 class="card-header">Leitor de Humidade</h5>
          <div class="card-body">
            <h2 class="card-title text-center">
              {{humidity}}%
            </h2>
            <p class="card-text text-center">
              <span class="badge badge-success">Normal</span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="/socket.io/socket.io.js"></script>
<script>
  let app = new Vue({
    el: "#app",
    data: {
      temp: 0,
      humidity: 0,
      tags: {
        normal: {
          label: 'Normal',
          class: 'success'
        },
        acceptable: {
          label: 'Aceitável',
          class: 'warning'
        },
        high: {
          label: 'Alta',
          class: 'danger'
        }
      },
      tag: null
    },
    watch: {
      temp: function (newValue) {
        this.updateTag(newValue)
      }
    },
    methods: {
      updateTag(temp){
        if(temp < 30){
          this.tag = this.tags.normal
        }
        else if(temp >= 30 && temp < 35){
          this.tag = this.tags.acceptable
        }else if(temp >= 35){
          this.tag = this.tags.high
        }
      }
    },
    mounted() {
      var socket = io();
      socket.on('sensortempufma', (msg) => {
        this.temp = msg
      });

      socket.on('sensorumidadeufma', (msg) => {
        this.humidity = msg
      });
    },
    computed: {
      heightWindow(){
        return window.innerHeight
      }
    }
  });

</script>
</html>